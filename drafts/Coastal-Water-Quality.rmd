---
title:
    | 
    | SMART Indicator Report: Coastal Water Quality
    | 
#date: "`r format(Sys.time(), '%B %d, %Y')`"
author: ""
always_allow_html: yes
bibliography: smartind.bib
link-citations: true
site: bookdown::bookdown_site
biblio-style: apalike
github-repo: MAFMC/SMARTindicatorsData
header-includes:
  \\usepackage{array}
favicon: favicon.ico
---

```{r, include = FALSE}
## Load packages
# library(tidyverse)
library(ggplot2)
library(tidyr)
library(dplyr)
library(ecodata)
library(plotly)
library(DT)
library(jpeg)
library(patchwork)
library(ggthemes)
library(here)
library(zoo)
library(gt)
library(kableExtra)
library(ggiraph)

knitr::opts_chunk$set(echo = F, message = F, warning = F, fig.align = 'center', eval.after = 'fig.cap')

## Read in needed data


## Put all mustaches here
indicator_name <- "Coastal Water Quality"
indicator_varname <- "ALL"

# cc_name <- "{{CC_NAME}}"
# common_name <- "{{COMMON_NAME}}"
# interactive <-  ifelse(knitr::is_latex_output(), F,T)
# 

## Pull out text and stats for indicator_name

  # check for stuff that needs escaping in indicator_name and escape it so detection works
  esc_indicator_name <- stringr::str_escape(indicator_name)

  # dummy values to get to gdoc, will be overwritten in main body
category <- ""
specific.1 <- NA
specific.2 <- NA
specific.3 <- NA
specific.4 <- NA
specific.5 <- NA
specific.6 <- NA
measurable.1 <- NA
measurable.2 <- NA
measurable.3 <- NA
measurable.4 <- NA
measurable.5 <- NA
measurable.6 <- NA
attainable.1 <- NA
attainable.2 <- NA
attainable.3 <- NA
relevant.1 <- NA
relevant.2 <- NA
relevant.3 <- NA
timebound.1 <- NA
timebound.2 <- NA
StartYear <- NA
EndYear <- NA

```

{{READMEStart}}

Welcome to this google doc draft SMART indicator report for Coastal Water Quality. This document requires hand editing to fill some or all sections. This workflow is inspired by the [Ecosystem Context for Stock Advice](https://github.com/NOAA-EDAB/ECSA/tree/master?tab=readme-ov-file#developing-an-ecsa-project) product workflow. You are looking at an intermediate draft that still needs some work.  

Do:

* Replace the text in [brackets] describing content for the section with the indicator specific content.
* Surround r code snippets with ``
* Look at the figures and develop text on how the patterns in the data might be informative to both the assessment and future advice for this stock. 
* Modify the text within sections beginning and ending with text inside double curly-bracket "mustaches". Anything in these sections will be harvested for the final report. 
* Add citations! If you have a citation to add, put it at the end of the section in BibTeX format (.bib; e.g., [here](https://www2.cs.arizona.edu/~collberg/Teaching/07.231/BibTeX/bibtex.html)). 
* Add scientific names, but instead of italicizing, use asterisks before and after, e.g., (*Stenotomus chrysops*).
* Before reading back into an rmd, *all changes must be accepted*

Don't:

* Alter the text within the mustaches! These are highly technical bookmarks that allow us to scrape the text from this google doc into a Rmarkdown (.rmd) file that will be rendered into both .pdf and .html reports. 
* Add new sections. If you want to add a new section, let sgaichas@hydrascientificllc.com know and we can modify the template.rmd at a later date.

{{READMEEnd}}

# Descriptive Section

## Indicator category

{{CategoryStart}}

[Select from: Habitat-Physical; Habitat-Living; Food-Web-Base; Fish; Protected; Fishery; Economic; Social; or Ocean-Use and add between quotes below, then delete this. If multiple categories, add both without punctuation]

r category <- ""

{{CategoryEnd}}

`r paste(category)`

## Indicator name

`r paste(indicator_name)`

Includes variable(s): `r paste(indicator_varname)`

## Indicator brief description

{{DescriptionStart}}

[2-3 sentences max plain language overview]

{{DescriptionEnd}}

`r specific.1 <- 1`

## Indicator visualization

{{VizDescriptionStart}}

[What are key trends or patterns we see in the indicator visualization?]

[Add a visualization using a link in markdown format !(caption text)[urllinktofig]]

{{VizDescriptionEnd}}

# SMART Attribute Section

## Indicator documentation

### Are indicators available for others to use (data downloadable)?

{{DownloadableStart}}

[Yes or No, add 1 if Yes and 0 if No to code below]

r measurable.1 <- NA

{{DownloadableEnd}}


#### Where can indicators be found?

{{DataLinkStart}}

[add link to indicator dataset, or state Unknown. Add 1 if link exists or 0 if Unknown to code below]

r measurable.2 <- NA

{{DataLinkEnd}}



#### How often are they updated? Are future updates likely?

{{UpdateFreqStart}}

[Add frequency of updates to date and speculate on continuation of the indicator, or state Unknown.]

{{UpdateFreqEnd}}

#### Who is the contact?

{{POCStart}}

[add contact info for indicator data, or state Unknown. Add 1 if contact info exists or 0 if Unknown to code below]

r measurable.3 <- NA

{{POCEnd}}



### Gather indicator statistics

#### Units

{{UnitsStart}}

[what are the specific units of each indicator in the dataset, or state Unknown. If all units are clear, score 1 in code below, if no units are listed, score 0 below. If some units are clear and others aren't, score  0.5]

r specific.2 <- NA

{{UnitsEnd}}

#### Length of time series, start and end date, periodicity

{{TSlengthStart}}

[Describe the temporal scale of the indicator; annual, monthly, daily? If scale is clear score 1 for timebound.1 below, if not specified score 0. Add specific begin and end years here in text and in code below, count missing years, or state Unknown. If end year is within 1 year of current year, score 1 for timebound.2 below. If end year is more than one but less than 5 years before current year, score 0.5, if end year is 5 or more years before current year, score 0]

r timebound.1 <- NA

r StartYear <- NA

r EndYear <- NA

r timebound.2 <- NA


{{TSlengthEnd}}

#### Spatial location, scale and extent

{{SpatialStart}}

[What is the spatial scale of the indicator? Add specifics if available (lat/long or state boundaries, etc.), or state Unknown. If scale is clearly specified, score 1 for specific.3 below, if not score 0]

r specific.3 <- NA

{{SpatialEnd}}

#### Management scale: all species, FMP level, species level, can it be aggregated or separated to different scales?

{{MgtScaleStart}}

[Classify by hand, note gridded data if available could be applied to different species ranges, or state Unknown.]

{{MgtScaleEnd}}

#### Uncertainty metrics

{{UncertaintyStart}}

[Yes or no. Are uncertainty metrics included for the indicator (e.g. SD, SE, CI?), if so which ones? If yes score 1 in the code below, if no score 0]

r specific.4 <- NA

{{UncertaintyEnd}}

### Are methods clearly documented to obtain source data and calculate indicators?

{{MethodsStart}}

[Yes or no. Are instructions or documentation for calculating the indicator included? Add citation or links. If yes score 1 below, if no score 0]

r specific.5 <- NA

{{MethodsEnd}}

#### Can the indicator be calculated from current documentation?

{{CanCalcStart}}

[Yes or no. Briefly state what is missing if no.]

{{CanCalcEnd}}

#### Is code publicly available? up to date?

{{CodeAvailStart}}

[Yes or no. Score 1 for yes, 0 for no below. If yes, add Link to indicator calculation code here and note most recent update]

r specific.6 <- NA

{{CodeAvailEnd}}

#### Have methods changed over time?

{{MethodChangeStart}}

[Record any changes in indicator methodology, or state Unknown.]

{{MethodChangeEnd}}

### Are indicator underlying source data linked or easy to find?

{{SourceDataAvailStart}}

[Yes or no. If Yes, score 1 below and Include link to source data (may be separate from indicator data). If no score 0 below]

r measurable.4 <- NA

{{SourceDataAvailEnd}}

#### Where are source data stored?

{{SourceDataStoreStart}}

[Location of indicator source data (may be separate from indicator data), or state Unknown. If location is know score 1 below, if unknown score 0]

r measurable.5 <- NA

{{SourceDataStoreEnd}}

#### How/by whom are source data updated? Are future updates likely?

{{SourceDataWhoUpdatesStart}}

[Agency and individuals responsible for source data (may be separate from indicator data), or state Unknown. Score 1 below if contact exists, score 0 if unknown]

r measurable.6 <- NA

{{SourceDataWhoUpdatseEnd}}

#### How often are they updated?

{{SourceDataUpdateFreqStart}}

[Record frequency of updates, or state Unknown.]

{{SourceDataUpdateFreqEnd}}


## Indicator analysis/testing or history of use

### What decision or advice processes are the indicators currently used in?

{{DecisionStart}}

[List details of each process and how the indicator is used. If a current Council process, select from the list of management actions/processes if relevant. Score 1 below if presented to or used by the Council or other management agency, score 0 if not]

r relevant.1 <- NA

{{DecisionEnd}}

### What implications of the indicators are currently listed?

{{ImplicationsStart}}

[List the implications of the indicator trends/status/pattern in its current use context, score 1 if implications are documented, score 0 if not]

r relevant.2 <- NA

{{ImplicationsEnd}}

### Do target, limit,  or threshold values already exist for the indicator?

{{RefptsStart}}

[Yes or no. If yes, sscore 1 below and list pecifcally what they are here. if none listed, score 0]

r relevant.3 <- NA

{{RefptsEnd}}

### Have the indicators been tested to ensure they respond proportionally to a change in the underlying process?

{{TestedStart}}

[Yes or no. If yes, briefly describe and add citations or links to analyses or previous experience using the indicator, and score 1 below, if no score 0]

r attainable.1 <- NA

{{TetstedEnd}}

### Are the indicators sensitive to a small change in the process, or what is the threshold of change that is detectable?

{{SensitiveStart}}

[Yes or no if the answer was yes to testing above. Otherwise, state Unknown. Score 1 for yes and 0 for no or unknown]

r attainable.2 <- NA

{{SensitiveEnd}}

### Is there a time lag between the process change and the indicator change? How long?

{{TimeLagStart}}

[Yes or no if the answer was yes to testing above. Otherwise, state Unknown. Score 1 for yes and 0 for no or unknown]

r attainable.3 <- NA

{{TimeLagEnd}}

# SMART rating

```{r SMART}

indratings <- c("Described" = specific.1, "Units" = specific.2, "Spatial" = specific.3, "Uncertainty" = specific.4, 
                "Methods" = specific.5, "Code" = specific.6,
             "Available" =  measurable.1, "Online" = measurable.2, "Contact" = measurable.3, "SourceDat" = measurable.4, 
             "SourceAvail" = measurable.5, "SourceContact" = measurable.6,
             "Tested" = attainable.1, "Sensitivity" = attainable.2, "TimeLag" = attainable.3,
             "Advice" = relevant.1, "Implications" = relevant.2, "TargThresh" = relevant.3,
             "Frequency" = timebound.1, "Updated" = timebound.2)

ratings <- stack(indratings)

colnames(ratings) <- c("Rating", "Attribute")

ratings$Element <- c(rep("Specific", 6),
                     rep("Measurable", 6),
                     rep("Achievable", 3),
                     rep("Relevant", 3),
                     rep("Timebound", 2))

ratings$Indicator <- unique(indicator_name)
ratings$Category <- category

ratings <- ratings[,c("Category", "Indicator", "Element", "Attribute", "Rating")]

elements <- ratings |>
  dplyr::group_by(Element) |>
  dplyr::summarise(ElementRating = mean(Rating, na.rm=TRUE))

overall <- elements |>
  dplyr::summarise(OverallRating = mean(ElementRating, na.rm=TRUE))

ratingsumm <- ratings |>
  dplyr::left_join(elements) |>
  dplyr::mutate(OverallRating = overall$OverallRating)

outfile <- paste0(here::here("data-raw/indratings/"), indicator_name, "_ratingsumm.csv")

write.csv(ratingsumm, outfile)

flextable::flextable(ratingsumm)

```

## Comments

### Additional potential links to management in addition to uses listed above

{{MgtPotentialStart}}

[Select from list of management processes/actions using exact keywords]

{{MgtPotentialEnd}}


### What additional work would be needed for the Council to use the indicator? 

{{AdditionalWorkStart}}

[List current gaps in the indicator given the current or potentail uses listed above, what resources are needed?]

{{AdditionalWorkEnd}}


### What issues are caused if there is a gap or delay in data underlying the indicator

{{DataDelayStart}}

[Link to management process/actions and their requirements]

{{DataDelayEnd}}



